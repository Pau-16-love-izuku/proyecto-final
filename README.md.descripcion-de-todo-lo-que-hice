##------- EN ESTE README VOY A AGREGAR TODAS LAS DESCRIPCIONES Y ALGUNOS CAMBIOS PRINCIPALES DE TODOS MIS ARCHIVOS DE INTENTO-------

# INTENTO 1: (descrpcion y explicacion)
#Proyecto final segundo parcial:
#planeacion:
#Voy a generar un programa en python usando tkinter para la administracion de permisos, vacaciones, o dias economicos que los trabajadores solicitan en un hospital, sin que sean descontados de su salario, utilizando una interfaz
#El programa va a consistir en el control de las asistencias totales 
#Pienso comenzar investigando como hacer la interfaz
#Luego, voy a determinar un cierto numero de trabajadores y voy a hacer el codigo en base a ese numero para darle un alto o que marque error si se ingresa un numero que no esta incluido en el sistema
#Voy a poner letreros que digan cosas como 'por favor ingresa tu numero de control' o 'porfavor ingresa tu puesto ' para tener los datos de entrada
#Voy a usar funciones como el if o for para determinar los dias de vacaiones y saber cuando un empledado respeta o no los periodos 
#voy a poner clases y un messagebox
#para que funcione voy a agregar una base con los datos, porque ya vi que para que los ingresen manual no funciona
#codigo
#para la base de datos voy a definir un taple si no existe asistencia de algun trabajador para que si este 
#sin persistencia de datos json, porque no esta hecho para guardar datos 
#agregare la funcion datetime para el codigo final porque si sirvio


# INTENTO 2
#codigo de prueba 2: (descripcion e intento)
#ya funciono pero le falta la entrada para agregar mas datos, y la parte que registra al trabajador aun no funciona bien :(

import tkinter as tk
from tkinter import messagebox, simpledialog
import sqlite3
from datetime import datetime
class Hospitalcontrol:
    def __init__(self, root):  
        self.root = root
        self.root.title("Control de Asistencia - Hospital")
        self.create_widgets()
        self.create_db()

    def create_widgets(self):
        self.entrada_button = tk.Button(self.root, text="Registrar Entrada", command=self.registrar_entrada)
        self.entrada_button.pack(pady=5)

        self.salida_button = tk.Button(self.root, text="Registrar Salida", command=self.registrar_salida)
        self.salida_button.pack(pady=5)

        self.reporte_button = tk.Button(self.root, text="Generar Reporte", command=self.generar_reporte)
        self.reporte_button.pack(pady=5)

    def create_db(self):
        self.conn = sqlite3.connect('database.db')
        self.cursor = self.conn.cursor()
        self.cursor.execute('''CREATE TABLE IF NOT EXISTS asistencia (
                                id INTEGER PRIMARY KEY,
                                nombre TEXT,
                                turno TEXT,
                                entrada DATETIME,
                                salida DATETIME)''')
        self.conn.commit()

    def registrar_entrada(self):
        nombre = simpledialog.askstring("Entrada", "Nombre del trabajador:")
        turno = simpledialog.askstring("Entrada", "Turno (M/V/N):").upper() if nombre else None
        if nombre and turno in ['M', 'V', 'N']:
            entrada = datetime.now()
            self.cursor.execute("INSERT INTO asistencia (nombre, turno, entrada) VALUES (?, ?, ?)",
                                (nombre, turno, entrada))
            self.conn.commit()
            messagebox.showinfo("칄xito", f"Entrada registrada para {nombre} en turno {turno}.")
        else:
            messagebox.showerror("Error", "Debe ingresar un nombre y un turno v치lido (M, V, N).")

    def registrar_salida(self):
        nombre = simpledialog.askstring("Salida", "Nombre del trabajador:")
        if nombre:
            salida = datetime.now()
            self.cursor.execute("UPDATE asistencia SET salida = ? WHERE nombre = ? AND salida IS NULL",
                                (salida, nombre))
            self.conn.commit()
            messagebox.showinfo("칄xito", f"Salida registrada para {nombre}.")
        else:
            messagebox.showerror("Error", "Debe ingresar un nombre.")

    def generar_reporte_trabajador(self):
        self.cursor.execute("SELECT nombre, turno, entrada, salida FROM asistencia")
        registros = self.cursor.fetchall()
        reporte = "Reporte de Asistencia:\n\n"
        for nombre, turno, entrada, salida in registros:
            entrada = datetime.strptime(entrada, '%Y-%m-%d %H:%M:%S')
            salida_dt = datetime.strptime(salida, '%Y-%m-%d %H:%M:%S') if salida else None
            horas_trabajadas = (salida_dt - entrada).total_seconds() / 3600 if salida_dt else 0
            reporte += f"{nombre} - Turno {turno} - Entrada: {entrada.strftime('%H:%M:%S')} - "
            reporte += f"Salida: {salida_dt.strftime('%H:%M:%S') if salida_dt else 'Pendiente'} - "
            reporte += f"Horas: {horas_trabajadas:.2f}\n"

        messagebox.showinfo("Reporte de Asistencia", reporte)

if __name__ == "__main__":  
    root = tk.Tk()
    app = HospitalApp(root)
    root.mainloop()


# INTENTO 3:

#este es mi tercer intento, porque ya le agregue botones para que si se puedan ingresar los datos por el trabajador, porque en el otro le faltaba entrada para datos
#aun conservo el datetime, aunque aun no lo uso bien
#utilize una lista para poder agregar los trabajadores y ya funciona el registro
#intento de codigo numero 3:
#la mayoria de los codigos los hago en code visual studio y ya los pongo aqui

import tkinter as tk
from tkinter import messagebox
from datetime import datetime
trabajadores = []
def registrar_horario():
    nombre = entry_nombre.get()
    entrada_str = entry_entrada.get()
    salida_str = entry_salida.get()
    try:
        entrada = datetime.strptime(entrada_str, "%H:%M")
        salida = datetime.strptime(salida_str, "%H:%M")
        hora_limite = datetime.strptime("07:20", "%H:%M")
        if entrada > hora_limite:
            estado = "Retardo"
        else:
            estado = "Puntual"
        if entrada > datetime.strptime("08:00", "%H:%M"):
            estado = "Falta"
        trabajador = {
            "Nombre": nombre,
            "Turno": turno_var.get(),
            "Domicilio": entry_domicilio.get(),
            "Puesto": puesto_var.get(),
            "Entrada": entrada_str,
            "Salida": salida_str,
            "Estado": estado
        }
        
        trabajadores.append(trabajador)
        messagebox.showinfo("Registrado", f"Horario registrado: {estado}")
    except ValueError:
        messagebox.showerror("Error", "Formato de hora inv치lido. Usa HH:MM")

ventana = tk.Tk()
ventana.title("Registro de Trabajadores")

tk.Label(ventana, text="Nombre:").grid(row=0, column=0)
entry_nombre = tk.Entry(ventana)
entry_nombre.grid(row=0, column=1)

tk.Label(ventana, text="Turno:").grid(row=1, column=0)
turno_var = tk.StringVar()
turno_var.set("Matutino")
tk.OptionMenu(ventana, turno_var, "Matutino", "Vespertino", "Nocturno").grid(row=1, column=1)

tk.Label(ventana, text="Domicilio:").grid(row=2, column=0)
entry_domicilio = tk.Entry(ventana)
entry_domicilio.grid(row=2, column=1)

tk.Label(ventana, text="Puesto:").grid(row=3, column=0)
puesto_var = tk.StringVar()
puesto_var.set("Doctor")
tk.OptionMenu(ventana, puesto_var, "Doctor", "Enfermero", "Cirujano").grid(row=3, column=1)

tk.Label(ventana, text="Hora Entrada (HH:MM):").grid(row=4, column=0)
entry_entrada = tk.Entry(ventana)
entry_entrada.grid(row=4, column=1)

tk.Label(ventana, text="Hora Salida (HH:MM):").grid(row=5, column=0)
entry_salida = tk.Entry(ventana)
entry_salida.grid(row=5, column=1)
tk.Button(ventana, text="Registrar Horario", command=registrar_horario).grid(row=6, column=0, columnspan=2, pady=10)
ventana.mainloop()

#INTENTO 4: 

#intento de codigo para el proyecto: 4
# en este ya le agregue el dato de la curp 
#agregue un boton que pide una contrase침a para que el trabajador pueda registrarse, porque se me ocurrio
#aun conservo las funciones como try e if


import tkinter as tk
from tkinter import messagebox
from datetime import datetime
trabajadores = []
intentos = 0
def registrar_horario():
    nombre = entry_nombre.get()
    entrada_str = entry_entrada.get()
    salida_str = entry_salida.get()

    try:
        entrada = datetime.strptime(entrada_str, "%I:%M %p")
        salida = datetime.strptime(salida_str, "%I:%M %p")
        hora_limite = datetime.strptime("7:20 AM", "%I:%M %p")

        if entrada > datetime.strptime("8:00 AM", "%I:%M %p"):
            estado = "Falta"
        elif entrada > hora_limite:
            estado = "Retardo"
        else:
            estado = "Puntual"

        trabajador = {
            "Nombre": nombre,
            "Turno": turno_var.get(),
            "Domicilio": entry_domicilio.get(),
            "Puesto": puesto_var.get(),
            "Entrada": entrada_str,
            "Salida": salida_str,
            "Estado": estado, 
            "CURP": entry_curp.get()
        }

        trabajadores.append(trabajador)
        messagebox.showinfo("Registrado", f"Horario registrado: {estado}")

    except ValueError:
        messagebox.showerror("Error", "Formato de hora inv치lido. Usa HH:MM AM/PM")


def mostrar_menu():
    login.destroy()  

    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")

    tk.Label(ventana, text="Nombre:").grid(row=0, column=0)
    global entry_nombre
    entry_nombre = tk.Entry(ventana)
    entry_nombre.grid(row=0, column=1)

    tk.Label(ventana, text="Turno:").grid(row=1, column=0)
    global turno_var
    turno_var = tk.StringVar()
    turno_var.set("Matutino")
    tk.OptionMenu(ventana, turno_var, "Matutino", "Vespertino", "Nocturno").grid(row=1, column=1)

    tk.Label(ventana, text="Domicilio:").grid(row=2, column=0)
    global entry_domicilio
    entry_domicilio = tk.Entry(ventana)
    entry_domicilio.grid(row=2, column=1)

    tk.Label(ventana, text="Puesto:").grid(row=3, column=0)
    global puesto_var
    puesto_var = tk.StringVar()
    puesto_var.set("Doctor")
    tk.OptionMenu(ventana, puesto_var, "Doctor", "Enfermero", "Cirujano").grid(row=3, column=1)

    tk.Label(ventana, text="Hora Entrada (ej. 7:10 AM):").grid(row=4, column=0)
    global entry_entrada
    entry_entrada = tk.Entry(ventana)
    entry_entrada.grid(row=4, column=1)

    tk.Label(ventana, text="Hora Salida (ej. 3:00 PM):").grid(row=5, column=0)
    global entry_salida
    entry_salida = tk.Entry(ventana)
    entry_salida.grid(row=5, column=1)
    
    tk.Label(ventana, text=" CURP:").grid(row=6, column=0)
    global entry_curp
    entry_curp = tk.Entry(ventana)
    entry_curp.grid(row=6, column=1)

    tk.Button(ventana, text="Registrar Horario", command=registrar_horario).grid(row=7, column=1, columnspan=2, pady=10)

def verificar_contrase침a():
    global intentos
    contrase침a = entry_contrase침a.get()

    if contrase침a == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Vuelve a intentarlo m치s tarde")
            login.destroy()

login = tk.Tk()
login.title("Login")
tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
entry_contrase침a = tk.Entry(login, show="*")
entry_contrase침a.pack()
tk.Button(login, text="Entrar", command=verificar_contrase침a).pack(pady=5)

login.mainloop()


# INTENTO 5: 

#intento 5 del codigo:
# en este intento, agregue una bienvenida al codigo para que se vea mas formal
# le puse de nombre a mi hospital "osamu", porque es un nombre que me gusto
#aun tengo la contrase침a despues de la bienvenida, que es hospital por si no lo puse en el codigo anterior 

import tkinter as tk
from tkinter import messagebox
from datetime import datetime

trabajadores = []
intentos = 0
def registrar_horario():
    nombre = entry_nombre.get()
    entrada_str = entry_entrada.get()
    salida_str = entry_salida.get()
    try:
        entrada = datetime.strptime(entrada_str, "%I:%M %p")
        salida = datetime.strptime(salida_str, "%I:%M %p")
        hora_limite = datetime.strptime("7:20 AM", "%I:%M %p")

        if entrada > datetime.strptime("8:00 AM", "%I:%M %p"):
            estado = "Falta"
        elif entrada > hora_limite:
            estado = "Retardo"
        else:
            estado = "Puntual"

        trabajador = {
            "Nombre": nombre,
            "Turno": turno_var.get(),
            "Domicilio": entry_domicilio.get(),
            "Puesto": puesto_var.get(),
            "츼rea": area_var.get(),
            "Entrada": entrada_str,
            "Salida": salida_str,
            "Estado": estado,
            "CURP": entry_curp.get()
        }

        trabajadores.append(trabajador)
        messagebox.showinfo("Registrado", f"Horario registrado: {estado}")
        resumen = (
            f"Nombre: {trabajador['Nombre']}, Turno: {trabajador['Turno']}, "
            f"Puesto: {trabajador['Puesto']}, 츼rea: {trabajador['츼rea']}, "
            f"Entrada: {trabajador['Entrada']}, Salida: {trabajador['Salida']}, "
            f"Estado: {trabajador['Estado']}, CURP: {trabajador['CURP']}\n"
        )
        text_area.insert(tk.END, resumen)

    except ValueError:
        messagebox.showerror("Error", "Formato de hora inv치lido. Usa AM/PM")

def mostrar_menu():
    login.destroy()
    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")
    ventana.config(bg="lightblue")

    tk.Label(ventana, text="Nombre:").grid(row=0, column=0)
    global entry_nombre
    entry_nombre = tk.Entry(ventana)
    entry_nombre.grid(row=0, column=1)

    tk.Label(ventana, text="Turno:").grid(row=1, column=0)
    global turno_var
    turno_var = tk.StringVar()
    turno_var.set("Matutino")
    tk.OptionMenu(ventana, turno_var, "Matutino", "Vespertino", "Nocturno").grid(row=1, column=1)

    tk.Label(ventana, text="Domicilio:").grid(row=2, column=0)
    global entry_domicilio
    entry_domicilio = tk.Entry(ventana)
    entry_domicilio.grid(row=2, column=1)

    tk.Label(ventana, text="Puesto:").grid(row=3, column=0)
    global puesto_var
    puesto_var = tk.StringVar()
    puesto_var.set("Doctor")
    tk.OptionMenu(ventana, puesto_var, "Doctor", "Enfermero", "Cirujano").grid(row=3, column=1)

    tk.Label(ventana, text="츼rea:").grid(row=4, column=0)
    global area_var
    area_var = tk.StringVar()
    area_var.set("Pediatr칤a")
    tk.OptionMenu(ventana, area_var, "Pediatr칤a", "Quir칩fano", "Operaciones", "Camillas", "Enfermer칤a").grid(row=4, column=1)

    tk.Label(ventana, text="Hora Entrada (ej. 7:10 AM):").grid(row=5, column=0)
    global entry_entrada
    entry_entrada = tk.Entry(ventana)
    entry_entrada.grid(row=5, column=1)

    tk.Label(ventana, text="Hora Salida (ej. 3:00 PM):").grid(row=6, column=0)
    global entry_salida
    entry_salida = tk.Entry(ventana)
    entry_salida.grid(row=6, column=1)

    tk.Label(ventana, text="CURP:").grid(row=7, column=0)
    global entry_curp
    entry_curp = tk.Entry(ventana)
    entry_curp.grid(row=7, column=1)

    tk.Button(ventana, text="Registrar Horario", command=registrar_horario).grid(row=8, column=0, columnspan=2, pady=10)

    global text_area
    text_area = tk.Text(ventana, height=10, width=80)
    text_area.grid(row=9, column=0, columnspan=2, padx=10, pady=10)

def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()

    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Vuelve a intentarlo m치s tarde")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login
    login = tk.Tk()
    login.title("verificacion de contrasena")
    login.geometry("400x200")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    global entry_contrasena
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()
    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=5)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu, (mi crush despues de deku)")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")

tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)
bienvenida.mainloop()

# INTENTO 6: 

#decidi que es muy facil que un trabajador mienta respecto a su horario, asi que mejor lo cambie para que el codigo registre la hora de la computadora automaticamente, ya use mas el datetime
#agregue un emoji de corazon en el nombre por estetica del codigo

import tkinter as tk
from tkinter import messagebox
from datetime import datetime, timedelta

trabajadores = {}
intentos = 0

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a") as f:
        f.write(f"{nombre} ({numero}) | Jornada: {t['jornada']} | Entrada: {t.get('entrada', 'N/A')} | "
                f"Salida: {t.get('salida', 'N/A')} | Estado: {t['estado']} | "
                f"Retardos: {t['retardos']} | Faltas: {t['faltas']}\n")

def obtener_estado(jornada, hora_actual):
    horarios = {
        "Matutina": datetime.strptime("7:00 AM", "%I:%M %p"),
        "Vespertina": datetime.strptime("12:00 PM", "%I:%M %p"),
        "Nocturna": datetime.strptime("5:00 PM", "%I:%M %p")
    }
    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"
    if hora_actual > inicio + timedelta(minutes=10):
        return "Retardo"
    return "Puntual"

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    jornada = jornada_var.get()
    clave = (nombre, numero)

    if not nombre or not numero:
        messagebox.showerror("Error", "Por favor, ingresa tu nombre y tu n칰mero de control.")
        return

    ahora = datetime.now()
    estado = obtener_estado(jornada, ahora)

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada,
            "retardos": 0,
            "faltas": 0
        }

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= 3:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, Entrada: {trabajadores[clave]['entrada']}, Estado: {estado}\n"
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)

    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada para este trabajador.")
        return

    salida = datetime.now().strftime("%I:%M %p")
    trabajadores[clave]["salida"] = salida

    resumen = f"[SALIDA] {nombre} ({numero}) - Salida: {salida}, Estado Final: {trabajadores[clave]['estado']}\n"
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

def mostrar_menu():
    login.destroy()
    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")
    ventana.config(bg="lightblue")

    tk.Label(ventana, text="Registro Autom치tico de Entrada/Salida", font=("Times New Roman", 14, "bold")).grid(row=0, column=0, columnspan=2, pady=10)

    tk.Label(ventana, text="Nombre:").grid(row=1, column=0, sticky='e')
    global entry_nombre
    entry_nombre = tk.Entry(ventana)
    entry_nombre.grid(row=1, column=1)

    tk.Label(ventana, text="N칰mero de Control:").grid(row=2, column=0, sticky='e')
    global entry_numero
    entry_numero = tk.Entry(ventana)
    entry_numero.grid(row=2, column=1)

    tk.Label(ventana, text="Jornada:").grid(row=3, column=0, sticky='e')
    global jornada_var
    jornada_var = tk.StringVar()
    jornada_var.set("Matutina")
    tk.OptionMenu(ventana, jornada_var, "Matutina", "Vespertina", "Nocturna").grid(row=3, column=1)

    tk.Button(ventana, text="Registrar Entrada", command=registrar_entrada).grid(row=4, column=0, pady=10)
    tk.Button(ventana, text="Registrar Salida", command=registrar_salida).grid(row=4, column=1, pady=10)

    global text_area
    text_area = tk.Text(ventana, height=15, width=80)
    text_area.grid(row=5, column=0, columnspan=2, padx=10, pady=10)

def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()
    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Demasiados intentos fallidos")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x200")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    global entry_contrasena
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()
    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=5)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")
tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)
bienvenida.mainloop()


# INTENTO 7: 

#intento7:
#agregue la contrase침a para que se pueda ingresar facilmente al sistema, porque antes solo yo sabia cual era la contrase침a
#agregue mas campos como NSS o numero de telefono, los cuales defin칤 para que, si el trabajador ingresa mas de los numeros programados, marque error cuando se quiera registrar y no lo deje continuar hasta que ingrese la cantidad de numeros correcta

import tkinter as tk
from tkinter import messagebox
from datetime import datetime, timedelta

trabajadores = {}
intentos = 0

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a") as f:
        f.write(f"{nombre} ({numero}) | Jornada: {t['jornada']} | Entrada: {t.get('entrada', 'N/A')} | "
                f"Salida: {t.get('salida', 'N/A')} | Estado: {t['estado']} | "
                f"Retardos: {t['retardos']} | Faltas: {t['faltas']} | "
                f"Celular: {t.get('celular', 'N/A')} | Domicilio: {t.get('domicilio', 'N/A')} | "
                f"Edad: {t.get('edad', 'N/A')} | G칠nero: {t.get('genero', 'N/A')} | NSS: {t.get('nss', 'N/A')}\n")

def obtener_estado(jornada, hora_actual):
    horarios = {
        "Matutina": datetime.strptime("7:00 AM", "%I:%M %p"),
        "Vespertina": datetime.strptime("12:00 PM", "%I:%M %p"),
        "Nocturna": datetime.strptime("5:00 PM", "%I:%M %p")
    }
    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"
    if hora_actual > inicio + timedelta(minutes=10):
        return "Retardo"
    return "Puntual"

def validar_datos(nombre, numero, celular, domicilio, edad, genero, nss):
    if not nombre or not numero or not celular or not domicilio or not edad or not genero or not nss:
        messagebox.showerror("Error", "Todos los campos deben estar completos.")
        return False

    if not edad.isdigit() or not (18 <= int(edad) <= 99):
        messagebox.showerror("Error", "Edad inv치lida. Debe ser un n칰mero entre 18 y 99.")
        return False

    if not celular.isdigit() or len(celular) != 10:
        messagebox.showerror("Error", "N칰mero de celular inv치lido. Debe tener exactamente 10 d칤gitos.")
        return False

    if not nss.isdigit() or len(nss) != 11:
        messagebox.showerror("Error", "NSS inv치lido. Debe tener exactamente 11 d칤gitos.")
        return False

    return True

def limpiar_campos():
    entry_nombre.delete(0, tk.END)
    entry_numero.delete(0, tk.END)
    entry_celular.delete(0, tk.END)
    entry_domicilio.delete(0, tk.END)
    entry_edad.delete(0, tk.END)
    entry_nss.delete(0, tk.END)
    jornada_var.set("Matutina")
    genero_var.set("Femenino")

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    jornada = jornada_var.get()
    celular = entry_celular.get()
    domicilio = entry_domicilio.get()
    edad = entry_edad.get()
    genero = genero_var.get()
    nss = entry_nss.get()
    clave = (nombre, numero)

    if not validar_datos(nombre, numero, celular, domicilio, edad, genero, nss):
        return

    ahora = datetime.now()
    estado = obtener_estado(jornada, ahora)

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada,
            "retardos": 0,
            "faltas": 0,
            "celular": celular,
            "domicilio": domicilio,
            "edad": edad,
            "genero": genero,
            "nss": nss
        }

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= 3:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, Entrada: {trabajadores[clave]['entrada']}, Estado: {estado}\n"
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)

    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada para este trabajador.")
        return

    salida = datetime.now().strftime("%I:%M %p")
    trabajadores[clave]["salida"] = salida

    resumen = f"[SALIDA] {nombre} ({numero}) - Salida: {salida}, Estado Final: {trabajadores[clave]['estado']}\n"
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def mostrar_menu():
    login.destroy()
    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")
    ventana.config(bg="lightblue")

    tk.Label(ventana, text="--- Registro Autom치tico de Entrada/Salida ---", font=("Arial", 12, "bold")).grid(row=0, column=0, columnspan=2, pady=10)

    def agregar_entrada(label_text, fila):
        tk.Label(ventana, text=label_text).grid(row=fila, column=0, sticky='e')
        entry = tk.Entry(ventana)
        entry.grid(row=fila, column=1)
        return entry

    global entry_nombre, entry_numero, entry_celular, entry_domicilio, entry_edad, entry_nss, jornada_var, genero_var

    entry_nombre = agregar_entrada("Nombre:", 1)
    entry_numero = agregar_entrada("N칰mero de Control:", 2)
    entry_celular = agregar_entrada("Celular:", 3)
    entry_domicilio = agregar_entrada("Domicilio:", 4)
    entry_edad = agregar_entrada("Edad:", 5)

    tk.Label(ventana, text="G칠nero:").grid(row=6, column=0, sticky='e')
    genero_var = tk.StringVar()
    genero_var.set("Femenino")
    tk.OptionMenu(ventana, genero_var, "Femenino", "Masculino").grid(row=6, column=1)

    entry_nss = agregar_entrada("NSS:", 7)

    tk.Label(ventana, text="Jornada:").grid(row=8, column=0, sticky='e')
    jornada_var = tk.StringVar()
    jornada_var.set("Matutina")
    tk.OptionMenu(ventana, jornada_var, "Matutina", "Vespertina", "Nocturna").grid(row=8, column=1)

    tk.Button(ventana, text="Registrar Entrada", command=registrar_entrada).grid(row=9, column=0, pady=10)
    tk.Button(ventana, text="Registrar Salida", command=registrar_salida).grid(row=9, column=1, pady=10)

    global text_area
    text_area = tk.Text(ventana, height=15, width=80)
    text_area.grid(row=10, column=0, columnspan=2, padx=10, pady=10)

def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()
    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Demasiados intentos fallidos")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x250")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    global entry_contrasena
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()

    tk.Label(login, text='(la contrase침a es "hospital")', fg="gray", font=("Arial", 9)).pack(pady=5)

    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=10)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")

tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)

bienvenida.mainloop()


# INTENTO 8:

#este es el intento 8
# le agregue la curp de nuevo porque no me habia fijado que la borre
#agregue un dato llamado area, para que el trabajador pueda seleccionar en que parte del hospital trabaja
#puse una entrada para CURP
#agregue un menu desplegable para seleccionar el 치rea del hospital en que trabaja
#se valida el CURP una vez ingresado
#se guarda el CURP y el 치rea en el archivo de texto junto con lo demas y se muestran en pantalla

import tkinter as tk
from tkinter import messagebox
from datetime import datetime, timedelta

trabajadores = {}
intentos = 0

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a") as f:
        f.write(f"{nombre} ({numero}) | Jornada: {t['jornada']} | Entrada: {t.get('entrada', 'N/A')} | "
                f"Salida: {t.get('salida', 'N/A')} | Estado: {t['estado']} | "
                f"Retardos: {t['retardos']} | Faltas: {t['faltas']} | "
                f"Celular: {t.get('celular', 'N/A')} | Domicilio: {t.get('domicilio', 'N/A')} | "
                f"Edad: {t.get('edad', 'N/A')} | G칠nero: {t.get('genero', 'N/A')} | NSS: {t.get('nss', 'N/A')} | "
                f"CURP: {t.get('curp', 'N/A')} | 츼rea: {t.get('area', 'N/A')}\n")


def obtener_estado(jornada, hora_actual):
    horarios = {
        "Matutina": datetime.strptime("7:00 AM", "%I:%M %p"),
        "Vespertina": datetime.strptime("12:00 PM", "%I:%M %p"),
        "Nocturna": datetime.strptime("5:00 PM", "%I:%M %p")
    }
    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"
    if hora_actual > inicio + timedelta(minutes=10):
        return "Retardo"
    return "Puntual"

def validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
    if not nombre or not numero or not celular or not domicilio or not edad or not genero or not nss or not curp:
        messagebox.showerror("Error", "Todos los campos deben estar completos.")
        return False

    if not edad.isdigit() or not (18 <= int(edad) <= 99):
        messagebox.showerror("Error", "Edad inv치lida. Debe ser un n칰mero entre 18 y 99.")
        return False

    if not celular.isdigit() or len(celular) != 10:
        messagebox.showerror("Error", "N칰mero de celular inv치lido. Asegurate de que tenga exactamente 10 d칤gitos.")
        return False

    if not nss.isdigit() or len(nss) != 11:
        messagebox.showerror("Error", "NSS inv치lido. Debe tener exactamente 11 d칤gitos.")
        return False

    if len(curp) != 18 or not curp.isalnum():
        messagebox.showerror("Error", "CURP inv치lido. Debe tener exactamente 18 caracteres alfanum칠ricos.")
        return False

    return True

def limpiar_campos():
    entry_nombre.delete(0, tk.END)
    entry_numero.delete(0, tk.END)
    entry_celular.delete(0, tk.END)
    entry_domicilio.delete(0, tk.END)
    entry_edad.delete(0, tk.END)
    entry_nss.delete(0, tk.END)
    entry_curp.delete(0, tk.END)   
    jornada_var.set("Matutina")
    genero_var.set("Femenino")
    area_var.set("General")       

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    jornada = jornada_var.get()
    celular = entry_celular.get()
    domicilio = entry_domicilio.get()
    edad = entry_edad.get()
    genero = genero_var.get()
    nss = entry_nss.get()
    curp = entry_curp.get()
    area = area_var.get()
    clave = (nombre, numero)

    if not validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
        return

    ahora = datetime.now()
    estado = obtener_estado(jornada, ahora)

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada,
            "retardos": 0,
            "faltas": 0,
            "celular": celular,
            "domicilio": domicilio,
            "edad": edad,
            "genero": genero,
            "nss": nss,
            "curp": curp,
            "area": area
        }

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= 3:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = (f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, Entrada: {trabajadores[clave]['entrada']}, "
               f"Estado: {estado}, CURP: {curp}, 츼rea: {area}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)

    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada para este trabajador.")
        return

    salida = datetime.now().strftime("%I:%M %p")
    trabajadores[clave]["salida"] = salida

    resumen = (f"[SALIDA] {nombre} ({numero}) - Salida: {salida}, Estado Final: {trabajadores[clave]['estado']}, "
               f"CURP: {trabajadores[clave].get('curp', 'N/A')}, 츼rea: {trabajadores[clave].get('area', 'N/A')}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def mostrar_menu():
    login.destroy()
    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")
    ventana.config(bg="lightblue")

    tk.Label(ventana, text="Registro Autom치tico de trabajadores (Entrada/Salida)", font=("Times New Roman", 12, "bold")).grid(row=0, column=0, columnspan=2, pady=10) 

    def agregar_entrada(label_text, fila):
        tk.Label(ventana, text=label_text).grid(row=fila, column=0, sticky='e')
        entry = tk.Entry(ventana)
        entry.grid(row=fila, column=1)
        return entry

    global entry_nombre, entry_numero, entry_celular, entry_domicilio, entry_edad, entry_nss, entry_curp
    global jornada_var, genero_var, area_var

    entry_nombre = agregar_entrada("Nombre:", 1)
    entry_numero = agregar_entrada("N칰mero de Control:", 2)
    entry_celular = agregar_entrada("Celular:", 3)
    entry_domicilio = agregar_entrada("Domicilio:", 4)
    entry_edad = agregar_entrada("Edad:", 5)

    tk.Label(ventana, text="G칠nero:").grid(row=6, column=0, sticky='e')
    genero_var = tk.StringVar()
    genero_var.set("Femenino")
    tk.OptionMenu(ventana, genero_var, "Femenino", "Masculino").grid(row=6, column=1)

    entry_nss = agregar_entrada("NSS:", 7)
    entry_curp = agregar_entrada("CURP:", 8)

    tk.Label(ventana, text="츼rea del Hospital:").grid(row=9, column=0, sticky='e')
    area_var = tk.StringVar()
    area_var.set("General")
    opciones_area = ["Camillas", "Consultorio", "Cirujano", "Doctor", "Cardiolog칤a", "Dermatolog칤a", "Pediatr칤a", 
                     "Sala de Operaciones", "Urgencias", "General"]
    tk.OptionMenu(ventana, area_var, *opciones_area).grid(row=9, column=1)

    tk.Label(ventana, text="Jornada:").grid(row=10, column=0, sticky='e')
    jornada_var = tk.StringVar()
    jornada_var.set("Matutina")
    tk.OptionMenu(ventana, jornada_var, "Matutina", "Vespertina", "Nocturna").grid(row=10, column=1)

    tk.Button(ventana, text="Registrar Entrada", command=registrar_entrada).grid(row=11, column=0, pady=10)
    tk.Button(ventana, text="Registrar Salida", command=registrar_salida).grid(row=11, column=1, pady=10)

    global text_area
    text_area = tk.Text(ventana, height=15, width=80)
    text_area.grid(row=12, column=0, columnspan=2, padx=10, pady=10)

def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()
    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Demasiados intentos fallidos")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x250")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    global entry_contrasena
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()

    tk.Label(login, text='(la contrase침a es "hospital")', fg="blue", font=("Times New Roman", 10)).pack(pady=5)

    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=10)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")

tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)

bienvenida.mainloop()


# INTENTO 9:

#intento numero 9: 
# en este intento, el codigo ya tiene los datos necesarios, auqneu aun le fanltan mejoras
# en este intento cambie la funcion de mostrar_menu, para que ahora aparezcan en diferentes apartados pero que sigan en la misma ventana
#tambien agregue una peque침a ventana dentro de la ventana principal que tiene los horarios de cada dia segun la jornada del trabajador
# lo dividi por datos basicos, que se necesitan para tener en el registro del hospital, y datos personales, para poder contactar al trabajador en caso de ser necesario, por ejemplo si acumula muchas faltas despues de 3 retardos cada una

import tkinter as tk
from tkinter import messagebox
from datetime import datetime, timedelta

trabajadores = {}
intentos = 0

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a") as f:
        f.write(f"{nombre} ({numero}) | Jornada: {t['jornada']} | Entrada: {t.get('entrada', 'N/A')} | "
                f"Salida: {t.get('salida', 'N/A')} | Estado: {t['estado']} | "
                f"Retardos: {t['retardos']} | Faltas: {t['faltas']} | "
                f"Celular: {t.get('celular', 'N/A')} | Domicilio: {t.get('domicilio', 'N/A')} | "
                f"Edad: {t.get('edad', 'N/A')} | G칠nero: {t.get('genero', 'N/A')} | NSS: {t.get('nss', 'N/A')} | "
                f"CURP: {t.get('curp', 'N/A')} | 츼rea: {t.get('area', 'N/A')} | D칤as: {t.get('dias', 'N/A')}\n")


def obtener_estado(jornada, hora_actual, dias):
    if dias in ["Lunes a Viernes", "Lun, Mar, Vie", "Mi칠, Jue, S치b"]:
        horarios = {
            "Matutina": datetime.strptime("7:00 AM", "%I:%M %p"),
            "Vespertina": datetime.strptime("12:00 PM", "%I:%M %p"),
            "Nocturna": datetime.strptime("5:00 PM", "%I:%M %p")
        }
    elif dias == "S치bado y Domingo":
        horarios = {
            "Matutina": datetime.strptime("8:00 AM", "%I:%M %p"),
            "Vespertina": datetime.strptime("1:00 PM", "%I:%M %p"),
            "Nocturna": datetime.strptime("6:00 PM", "%I:%M %p")
        }
    else:
        return "Jornada inv치lida"

    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"

    if hora_actual.time() > (inicio + timedelta(minutes=10)).time():
        return "Retardo"
    return "Puntual"

def validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
    if not nombre or not numero or not celular or not domicilio or not edad or not genero or not nss or not curp:
        messagebox.showerror("Error", "Todos los campos deben estar completos.")
        return False

    if not edad.isdigit() or not (18 <= int(edad) <= 99):
        messagebox.showerror("Error", "Edad inv치lida. Debe ser un n칰mero entre 18 y 99.")
        return False

    if not celular.isdigit() or len(celular) != 10:
        messagebox.showerror("Error", "N칰mero de celular inv치lido. Debe tener exactamente 10 d칤gitos.")
        return False

    if not nss.isdigit() or len(nss) != 11:
        messagebox.showerror("Error", "NSS inv치lido. Debe tener exactamente 11 d칤gitos.")
        return False

    if len(curp) != 18 or not curp.isalnum():
        messagebox.showerror("Error", "CURP inv치lido. Debe tener exactamente 18 caracteres alfanum칠ricos.")
        return False

    return True

def limpiar_campos():
    entry_nombre.delete(0, tk.END)
    entry_numero.delete(0, tk.END)
    entry_celular.delete(0, tk.END)
    entry_domicilio.delete(0, tk.END)
    entry_edad.delete(0, tk.END)
    entry_nss.delete(0, tk.END)
    entry_curp.delete(0, tk.END)   
    jornada_var.set("Matutina")
    genero_var.set("Femenino")
    area_var.set("General")
    dias_var.set("Lunes a Viernes")  

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    jornada = jornada_var.get()
    celular = entry_celular.get()
    domicilio = entry_domicilio.get()
    edad = entry_edad.get()
    genero = genero_var.get()
    nss = entry_nss.get()
    curp = entry_curp.get()
    area = area_var.get()
    dias = dias_var.get()  
    clave = (nombre, numero)

    if not validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
        return

    ahora = datetime.now()
    estado = obtener_estado(jornada, ahora, dias)  

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada,
            "retardos": 0,
            "faltas": 0,
            "celular": celular,
            "domicilio": domicilio,
            "edad": edad,
            "genero": genero,
            "nss": nss,
            "curp": curp,
            "area": area,
            "dias": dias
        }

    else:
        trabajadores[clave]["dias"] = dias
        trabajadores[clave]["jornada"] = jornada
        trabajadores[clave]["celular"] = celular
        trabajadores[clave]["domicilio"] = domicilio
        trabajadores[clave]["edad"] = edad
        trabajadores[clave]["genero"] = genero
        trabajadores[clave]["nss"] = nss
        trabajadores[clave]["curp"] = curp
        trabajadores[clave]["area"] = area

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= 3:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = (f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, D칤as: {dias}, Entrada: {trabajadores[clave]['entrada']}, "
               f"Estado: {estado}, CURP: {curp}, 츼rea: {area}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)

    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada para este trabajador.")
        return

    salida = datetime.now().strftime("%I:%M %p")
    trabajadores[clave]["salida"] = salida

    resumen = (f"[SALIDA] {nombre} ({numero}) - Salida: {salida}, Estado Final: {trabajadores[clave]['estado']}, "
               f"CURP: {trabajadores[clave].get('curp', 'N/A')}, 츼rea: {trabajadores[clave].get('area', 'N/A')}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)

    limpiar_campos()

def mostrar_menu():
    login.destroy()
    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")
    ventana.config(bg="lightblue")

    tk.Label(ventana, text="Registro Autom치tico de trabajadores (Entrada/Salida)", font=("Times New Roman", 12, "bold")).pack(pady=10)

    global entry_nombre, entry_numero, entry_celular, entry_domicilio, entry_edad, entry_nss, entry_curp
    global jornada_var, genero_var, area_var, dias_var

    marco_principal = tk.Frame(ventana, bg="lightblue")
    marco_principal.pack()

    marco_basico = tk.LabelFrame(marco_principal, text="Datos B치sicos", padx=10, pady=10, bg="lightblue")
    marco_basico.grid(row=0, column=0, padx=10, pady=10, sticky="n")

    def entrada_en_marco(marco, texto, fila):
        tk.Label(marco, text=texto, bg="lightblue").grid(row=fila, column=0, sticky='e')
        entry = tk.Entry(marco)
        entry.grid(row=fila, column=1)
        return entry

    entry_nombre = entrada_en_marco(marco_basico, "Nombre:", 0)
    entry_numero = entrada_en_marco(marco_basico, "N칰mero de Control:", 1)

    tk.Label(marco_basico, text="Jornada:", bg="lightblue").grid(row=2, column=0, sticky='e')
    jornada_var = tk.StringVar()
    jornada_var.set("Matutina")
    tk.OptionMenu(marco_basico, jornada_var, "Matutina", "Vespertina", "Nocturna").grid(row=2, column=1)

    tk.Label(marco_basico, text="D칤as de trabajo:", bg="lightblue").grid(row=3, column=0, sticky='e')
    dias_var = tk.StringVar()
    dias_var.set("Lunes a Viernes")
    opciones_dias = ["Lunes a Viernes", "S치bado y Domingo", "Lun, Mar, Vie", "Mi칠, Jue, S치b"]
    tk.OptionMenu(marco_basico, dias_var, *opciones_dias).grid(row=3, column=1)

    marco_personal = tk.LabelFrame(marco_principal, text="Informaci칩n Personal", padx=10, pady=10, bg="lightblue")
    marco_personal.grid(row=1, column=0, padx=10, pady=10, sticky="n")

    entry_celular = entrada_en_marco(marco_personal, "Celular:", 0)
    entry_domicilio = entrada_en_marco(marco_personal, "Domicilio:", 1)
    entry_edad = entrada_en_marco(marco_personal, "Edad:", 2)

    tk.Label(marco_personal, text="G칠nero:", bg="lightblue").grid(row=3, column=0, sticky='e')
    genero_var = tk.StringVar()
    genero_var.set("Femenino")
    tk.OptionMenu(marco_personal, genero_var, "Femenino", "Masculino").grid(row=3, column=1)

    entry_nss = entrada_en_marco(marco_personal, "NSS:", 4)
    entry_curp = entrada_en_marco(marco_personal, "CURP:", 5)

    marco_area = tk.LabelFrame(marco_principal, text="츼rea del Hospital", padx=10, pady=10, bg="lightblue")
    marco_area.grid(row=2, column=0, padx=10, pady=10, sticky="n")

    tk.Label(marco_area, text="츼rea:", bg="lightblue").grid(row=0, column=0, sticky='e')
    area_var = tk.StringVar()
    area_var.set("General")
    opciones_area = ["Camillas", "Consultorio", "Cirujano", "Doctor", "Cardiolog칤a", "Dermatolog칤a", "Pediatr칤a", 
                     "Sala de Operaciones", "Urgencias", "General"]
    tk.OptionMenu(marco_area, area_var, *opciones_area).grid(row=0, column=1)

    marco_horarios = tk.LabelFrame(marco_principal, text="Horarios por jornada", padx=10, pady=10, bg="white")
    marco_horarios.grid(row=0, column=1, rowspan=3, padx=20, pady=10, sticky="n")

    horarios_texto = (
        "游늱 Lunes a Viernes:\n"
        "  Matutina: 7:00 AM - 3:00 PM\n"
        "  Vespertina: 12:00 PM - 8:00 PM\n"
        "  Nocturna: 5:00 PM - 1:00 AM\n\n"
        "游늱 S치bado y Domingo:\n"
        "  Matutina: 8:00 AM - 4:00 PM\n"
        "  Vespertina: 1:00 PM - 9:00 PM\n"
        "  Nocturna: 6:00 PM - 2:00 AM\n\n"
        "游늱 Lun, Mar, Vie:\n"
        "  Matutina: 7:00 AM - 3:00 PM\n"
        "  Vespertina: 12:00 PM - 8:00 PM\n"
        "  Nocturna: 5:00 PM - 1:00 AM\n\n"
        "游늱 Mi칠, Jue, S치b:\n"
        "  Matutina: 7:00 AM - 3:00 PM\n"
        "  Vespertina: 12:00 PM - 8:00 PM\n"
        "  Nocturna: 5:00 PM - 1:00 AM"
    )

    tk.Label(marco_horarios, text=horarios_texto, justify="left", bg="white", font=("Arial", 10)).pack()

    botones_frame = tk.Frame(ventana, bg="lightblue")
    botones_frame.pack(pady=10)

    tk.Button(botones_frame, text="Registrar Entrada", command=registrar_entrada).grid(row=0, column=0, padx=10)
    tk.Button(botones_frame, text="Registrar Salida", command=registrar_salida).grid(row=0, column=1, padx=10)

    global text_area
    text_area = tk.Text(ventana, height=15, width=100)
    text_area.pack(padx=10, pady=10)


def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()
    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Demasiados intentos fallidos")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x250")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    global entry_contrasena
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()

    tk.Label(login, text='(la contrase침a es "hospital")', fg="blue", font=("Times New Roman", 10)).pack(pady=5)

    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=10)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")

tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)
bienvenida.mainloop()

# INTENTO 10: 

#intento 10:
#en este intento, converti el registro en una tabla para que fuera mas facil ver a los trabajadores, mi tabla por ahora consta de solo dos secciones, aun me falta agregar el registro para las vacaciones
#modifique un poco el codigo para que ahora tenga otro apartado que permite seleccionar el tipo de departamento del trabajador
#agregue los departamentos y puestos en el hospital para que los trabajadores los puedan seleccionar, hice que aparecieran a forma de lista para que sea mas facil 
#corregi unos errores peque침os, ahora para que funcione solo necesito hacer que guarde los datos de los departamentos y puestos en el historial, porque aun no los registra


import tkinter as tk
from tkinter import ttk, messagebox
from datetime import datetime, timedelta

trabajadores = {}
intentos = 0

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a") as f:
        f.write(f"{nombre} ({numero}) | Jornada: {t['jornada']} | Entrada: {t.get('entrada', 'N/A')} | "
                f"Salida: {t.get('salida', 'N/A')} | Estado: {t['estado']} | "
                f"Retardos: {t['retardos']} | Faltas: {t['faltas']} | "
                f"Celular: {t.get('celular', 'N/A')} | Domicilio: {t.get('domicilio', 'N/A')} | "
                f"Edad: {t.get('edad', 'N/A')} | G칠nero: {t.get('genero', 'N/A')} | NSS: {t.get('nss', 'N/A')} | "
                f"CURP: {t.get('curp', 'N/A')} | 츼rea: {t.get('area', 'N/A')} | D칤as: {t.get('dias', 'N/A')}\n")

def obtener_estado(jornada, hora_actual, dias):
    if dias in ["Lunes a Viernes", "Lun, Mar, Vie", "Mi칠, Jue, S치b"]:
        horarios = {
            "Matutina": datetime.strptime("07:00", "%H:%M").time(),
            "Vespertina": datetime.strptime("12:00", "%H:%M").time(),
            "Nocturna": datetime.strptime("17:00", "%H:%M").time()
        }
    elif dias == "S치bado y Domingo":
        horarios = {
            "Matutina": datetime.strptime("08:00", "%H:%M").time(),
            "Vespertina": datetime.strptime("13:00", "%H:%M").time(),
            "Nocturna": datetime.strptime("18:00", "%H:%M").time()
        }
    else:
        return "Jornada inv치lida"

    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"

    hora_entrada = hora_actual.time()
    diferencia = (datetime.combine(datetime.today(), hora_entrada) - datetime.combine(datetime.today(), inicio)).total_seconds() / 60

    if diferencia > 10:
        return "Retardo"
    elif diferencia >= 0:
        return "Puntual"
    else:
        return "Antes de tiempo"

def validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
    if not nombre or not numero or not celular or not domicilio or not edad or not genero or not nss or not curp:
        messagebox.showerror("Error", "Todos los campos deben estar completos.")
        return False

    if not edad.isdigit() or not (18 <= int(edad) <= 99):
        messagebox.showerror("Error", "Edad inv치lida. Debe ser un n칰mero entre 18 y 99.")
        return False

    if not celular.isdigit() or len(celular) != 10:
        messagebox.showerror("Error", "N칰mero de celular inv치lido. Debe tener exactamente 10 d칤gitos.")
        return False

    if not nss.isdigit() or len(nss) != 11:
        messagebox.showerror("Error", "NSS inv치lido. Debe tener exactamente 11 d칤gitos.")
        return False

    if len(curp) != 18 or not curp.isalnum():
        messagebox.showerror("Error", "CURP inv치lido. Debe tener exactamente 18 caracteres alfanum칠ricos.")
        return False
    return True

def limpiar_campos():
    for entry in [entry_nombre, entry_numero, entry_celular, entry_domicilio, entry_edad, entry_nss, entry_curp]:
        entry.delete(0, tk.END)
    jornada_var.set("Matutina")
    genero_var.set("Femenino")
    area_var.set("General")
    dias_var.set("Lunes a Viernes")

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    jornada = jornada_var.get()
    celular = entry_celular.get()
    domicilio = entry_domicilio.get()
    edad = entry_edad.get()
    genero = genero_var.get()
    nss = entry_nss.get()
    curp = entry_curp.get()
    area = area_var.get()
    dias = dias_var.get()
    clave = (nombre, numero)

    if not validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
        return

    ahora = datetime.now()
    estado = obtener_estado(jornada, ahora, dias)

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada,
            "retardos": 0,
            "faltas": 0,
            "celular": celular,
            "domicilio": domicilio,
            "edad": edad,
            "genero": genero,
            "nss": nss,
            "curp": curp,
            "area": area,
            "dias": dias
        }
    else:
        trabajadores[clave].update({
            "dias": dias, "jornada": jornada, "celular": celular, "domicilio": domicilio,
            "edad": edad, "genero": genero, "nss": nss, "curp": curp, "area": area
        })

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= 3:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = (f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, D칤as: {dias}, Entrada: {trabajadores[clave]['entrada']}, "
               f"Estado: {estado}, CURP: {curp}, 츼rea: {area}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)
    limpiar_campos()

def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)

    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada para este trabajador.")
        return

    salida = datetime.now().strftime("%I:%M %p")
    trabajadores[clave]["salida"] = salida

    resumen = (f"[SALIDA] {nombre} ({numero}) - Salida: {salida}, Estado Final: {trabajadores[clave]['estado']}, "
               f"CURP: {trabajadores[clave].get('curp', 'N/A')}, 츼rea: {trabajadores[clave].get('area', 'N/A')}\n")
    text_area.insert(tk.END, resumen)
    guardar_registro(nombre, numero)
    limpiar_campos()

def mostrar_menu():
    login.destroy()
    global entry_nombre, entry_numero, entry_celular, entry_domicilio, entry_edad, entry_nss, entry_curp
    global jornada_var, genero_var, area_var, dias_var, text_area

    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores Hospital Osamu")

    notebook = ttk.Notebook(ventana)
    notebook.pack(fill="both", expand=True)

    tab_registro = ttk.Frame(notebook)
    notebook.add(tab_registro, text="Datos del Trabajador")

    labels = ["Nombre:", "N칰mero de Control:", "Celular:", "Domicilio:", "Edad:", "G칠nero:", "NSS:", "CURP:", "츼rea:", "Jornada:", "D칤as de trabajo:"]
    entries = {}

    for i, label in enumerate(labels):
        tk.Label(tab_registro, text=label).grid(row=i, column=0, sticky="e", pady=2)
        if label in ["G칠nero:", "츼rea:", "Jornada:", "D칤as de trabajo:"]:
            var = tk.StringVar()
            if label == "G칠nero:": genero_var = var; var.set("Femenino"); opciones = ["Femenino", "Masculino"]
            elif label == "츼rea:": area_var = var; var.set("General"); opciones = ["Camillas", "Consultorio", "Cirujano", "Doctor", "Cardiolog칤a", "Dermatolog칤a", "Pediatr칤a", "Sala de Operaciones", "Urgencias", "General"]
            elif label == "Jornada:": jornada_var = var; var.set("Matutina"); opciones = ["Matutina", "Vespertina", "Nocturna"]
            elif label == "D칤as de trabajo:": dias_var = var; var.set("Lunes a Viernes"); opciones = ["Lunes a Viernes", "S치bado y Domingo", "Lun, Mar, Vie", "Mi칠, Jue, S치b"]
            ttk.Combobox(tab_registro, textvariable=var, values=opciones, state="readonly").grid(row=i, column=1)
        else:
            entry = tk.Entry(tab_registro)
            entry.grid(row=i, column=1)
            entries[label] = entry

    entry_nombre = entries["Nombre:"]
    entry_numero = entries["N칰mero de Control:"]
    entry_celular = entries["Celular:"]
    entry_domicilio = entries["Domicilio:"]
    entry_edad = entries["Edad:"]
    entry_nss = entries["NSS:"]
    entry_curp = entries["CURP:"]

    
    tk.Button(tab_registro, text="Registrar Entrada", command=registrar_entrada).grid(row=len(labels), column=0, pady=10)
    tk.Button(tab_registro, text="Registrar Salida", command=registrar_salida).grid(row=len(labels), column=1, pady=10)

    
    tab_historial = ttk.Frame(notebook)
    notebook.add(tab_historial, text="Historial")

    text_area = tk.Text(tab_historial, height=20, width=100)
    text_area.pack(padx=10, pady=10)
    
    tab_departamentos = ttk.Frame(notebook)
    notebook.add(tab_departamentos, text="Departamentos")

    tree = ttk.Treeview(tab_departamentos)
    global tree_departamentos_global
    tree_departamentos_global = tree

    tree.heading("#0", text="Departamentos del Hospital", anchor="w")

    datos_departamentos = {
        "Cl칤nicos / Asistenciales": [
            "Medicina Interna", "Cirug칤a General", "Ginecolog칤a y Obstetricia", "Anestesiolog칤a",
            "Cuidados Intensivos (UCI)", "Psiquiatr칤a", "Oncolog칤a", "Neurolog칤a",
            "Rehabilitaci칩n", "Diagn칩stico por imagen (radiolog칤a, ecograf칤as, etc.)", "Laboratorio cl칤nico"
        ],
        "Enfermer칤a": [
            "Enfermer칤a general", "Enfermer칤a especializada (UCI, quir칩fano, pediatr칤a, etc.)",
            "Supervisi칩n de enfermer칤a"
        ],
        "Administrativos / Gesti칩n": [
            "Direcci칩n general", "Recursos humanos", "Finanzas / Contabilidad", "Compras y log칤stica",
            "Admisiones y archivo cl칤nico", "Sistemas / Inform치tica"
        ],
        "Apoyo y servicios generales": [
            "Mantenimiento", "Limpieza", "Cocina y nutrici칩n", "Lavander칤a", "Seguridad",
            "Transporte interno de pacientes"
        ]
    }

    for categoria, subcategorias in datos_departamentos.items():
        parent = tree.insert("", "end", text=categoria)
        for sub in subcategorias:
            tree.insert(parent, "end", text=sub)

    tree.pack(fill="both", expand=True, padx=10, pady=10)

    tab_puestos = ttk.Frame(notebook)
    notebook.add(tab_puestos, text="Puesto en el hospital")

    tk.Label(tab_puestos, text="Selecciona tu puesto en el hospital:", font=("Arial", 12)).pack(pady=10)

    puestos = [
        "Personal m칠dico:",
        "  - M칠dico/a general",
        "  - Especialista (cardi칩logo, neur칩logo, etc.)",
        "  - M칠dico residente (en formaci칩n)",
        "  - M칠dico de urgencias",
        "  - Anestesi칩logo",
        "  - Cirujano/a",
        "Personal de enfermer칤a:",
        "  - Enfermero/a",
        "  - Auxiliar de enfermer칤a (TCAE o TENS seg칰n el pa칤s)",
        "  - Supervisor/a de enfermer칤a",
        "Personal t칠cnico:",
        "  - T칠cnico de laboratorio",
        "  - T칠cnico de radiolog칤a",
        "  - T칠cnico en anatom칤a patol칩gica",
        "  - T칠cnico de farmacia",
        "Personal administrativo:",
        "  - Recepcionista / Admisi칩n",
        "  - Auxiliar administrativo",
        "  - Contable",
        "  - Responsable de RRHH",
        "  - Director financiero",
        "  - Jefe de compras",
        "Otros puestos:",
        "  - Celador (traslado de pacientes, apoyo en quir칩fano, etc.)",
        "  - Personal de limpieza",
        "  - Cocineros y dietistas",
        "  - Personal de mantenimiento",
        "  - Personal de seguridad"
    ]

    frame_listbox = tk.Frame(tab_puestos)
    frame_listbox.pack(pady=10, padx=10, fill="both", expand=True)

    scrollbar = tk.Scrollbar(frame_listbox)
    scrollbar.pack(side="right", fill="y")

    listbox_puestos = tk.Listbox(frame_listbox, yscrollcommand=scrollbar.set, selectmode="browse", height=15, width=70)
    for puesto in puestos:
        listbox_puestos.insert(tk.END, puesto)

    listbox_puestos.pack(side="left", fill="both", expand=True)
    global listbox_puestos_global
    listbox_puestos_global = listbox_puestos

    scrollbar.config(command=listbox_puestos.yview)

    ventana.mainloop()

def verificar_contrasena():
    global intentos
    contrasena = entry_contrasena.get()
    if contrasena == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contrase침a incorrecta, int칠ntalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Demasiados intentos fallidos")
            login.destroy()

def abrir_login():
    bienvenida.destroy()
    global login, entry_contrasena
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x250")
    login.config(bg="lightpink")

    tk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    entry_contrasena = tk.Entry(login, show="*")
    entry_contrasena.pack()
    tk.Label(login, text='(la contrase침a es "hospital")', fg="blue", font=("Times New Roman", 10)).pack(pady=5)
    tk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=10)

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")
tk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
tk.Button(bienvenida, text="Presione para continuar", command=abrir_login).pack(pady=10)
bienvenida.mainloop()

# INTENTO 11: 
(SOLO LA DESCRIPCION, TUVE PROBLEMAS PARA AGREGAR EL CODIGO AQUI)
#mi intento 11:
#segui agregando pesta침as a la misma ventana para que el trabajador pueda seleccionar mas libremente su area de trabajo, el puesto, etc
#aunque tiene el peque침o detalle de que le movi y ya no guarda y registra automaticamente los datos, ni tampoco los limpia, asi que lo arreglare
#corregi el codigo para que ya guarde los datos, pero por error borre algunas de sus caracteristicas, asi que lo arreglare
#ya lo arregle mas
#ya lo segui editando para que tenga todas las pesta침as que yo queria que tuviera, y ya tiene las vacaciones integradas, solo me falta ajustarlo un poco y ya
#sigo haciendo mejoras


# INTENTO 12: 

#en este intento decidi que voy a mejorar mucho mas el codigo
#ya revise mi codigo de nuevo por algunos problemas, pero ya registra y se guarda la informacion en un archivo y se muestra en el historial
#ya cuenta las vacaciones y se guia por los datos de Nombre del trabajador y por el numero de control
#ya solo voy a agregar una pesta침a en la que se de a manera de listado los datos del historial para que sea mas facil visualizar la informacion del trabajador 
#tambien corregi un poco el codigo, porque note que cuando el trabajador queria registrar su entrada, no lo dejaba porque no guardaba la seleccion de el puesto, departamento y tipo de contrato y no los registraba en el historial
#corregi esa parte y ya lo registra, lo puse a manera de una lista y reduje las opciones para que si pueda tomar y registrar
#ya agregue la pesta침a para el listado, pero aun no registra los datos como el historial, corregire eso y agregare un buscador para localizar a los trabajadores mas facilmente por nombre o por numero de control

import tkinter as tk
from tkinter import ttk, messagebox
from datetime import datetime, timedelta
import json, os

archivo_datos = "trabajadores.json"
if os.path.exists(archivo_datos):
    with open(archivo_datos, "r", encoding="utf-8") as f:
        data = json.load(f)
    trabajadores = {tuple(k.split("||")): v for k, v in data.items()}
else:
    trabajadores = {}

LIMITE_POR_TURNO = 2
RETARDOS_PARA_FALTA = 3
intentos = 0

def guardar_datos_json():
    serial = {"||".join(k): v for k, v in trabajadores.items()}
    with open(archivo_datos, "w", encoding="utf-8") as f:
        json.dump(serial, f, indent=4, ensure_ascii=False)

def guardar_registro(nombre, numero):
    clave = (nombre, numero)
    if clave not in trabajadores:
        return
    t = trabajadores[clave]
    with open("registro_trabajadores.txt", "a", encoding="utf-8") as f:
        f.write(
            f"{nombre} ({numero}) | Jornada: {t.get('jornada','N/A')} | Entrada: {t.get('entrada','N/A')} | "
            f"Salida: {t.get('salida','N/A')} | Estado: {t.get('estado','N/A')} | "
            f"Retardos: {t.get('retardos',0)} | Faltas: {t.get('faltas',0)} | "
            f"Celular: {t.get('celular','N/A')} | Domicilio: {t.get('domicilio','N/A')} | "
            f"Edad: {t.get('edad','N/A')} | G칠nero: {t.get('genero','N/A')} | NSS: {t.get('nss','N/A')} | "
            f"CURP: {t.get('curp','N/A')} | 츼rea: {t.get('area','N/A')} | D칤as: {t.get('dias','N/A')} | "
            f"Departamento: {t.get('departamento','N/A')} | Puesto: {t.get('puesto','N/A')} | "
            f"Tipo de Contrato: {t.get('tipo_contrato','N/A')}\n"
        )

def rango_fechas(inicio, fin):
    inicio = datetime.strptime(inicio, "%Y-%m-%d")
    fin = datetime.strptime(fin, "%Y-%m-%d")
    return [(inicio + timedelta(days=i)).strftime("%Y-%m-%d")
            for i in range((fin - inicio).days + 1)]

def validar_vacaciones(turno, fechas):
    conteo = {f: 0 for f in fechas}
    for clave, t in trabajadores.items():
        if t.get("turno") == turno:
            for f in t.get("vacaciones", []):
                if f in conteo:
                    conteo[f] += 1
                    if conteo[f] >= LIMITE_POR_TURNO:
                        return False, f
    return True, None

def obtener_estado(jornada, hora_actual, dias):
    if dias in ["Lunes a Viernes", "Lun, Mar, Vie", "Mi칠, Jue, S치b"]:
        horarios = {
            "Matutina": datetime.strptime("07:00", "%H:%M").time(),
            "Vespertina": datetime.strptime("12:00", "%H:%M").time(),
            "Nocturna": datetime.strptime("17:00", "%H:%M").time()
        }
    elif dias == "S치bado y Domingo":
        horarios = {
            "Matutina": datetime.strptime("08:00", "%H:%M").time(),
            "Vespertina": datetime.strptime("13:00", "%H:%M").time(),
            "Nocturna": datetime.strptime("18:00", "%H:%M").time()
        }
    else:
        return "Jornada inv치lida"
    inicio = horarios.get(jornada)
    if not inicio:
        return "Jornada inv치lida"
    diff = (datetime.combine(datetime.today(), hora_actual.time()) -
            datetime.combine(datetime.today(), inicio)).total_seconds() / 60
    if diff > 10:
        return "Retardo"
    elif diff >= 0:
        return "Puntual"
    else:
        return "Antes de tiempo"

def validar_datos(nombre, numero, celular, domicilio, edad, genero, nss, curp):
    if not all([nombre, numero, celular, domicilio, edad, genero, nss, curp]):
        messagebox.showerror("Error", "Todos los campos deben estar completos.")
        return False
    if not edad.isdigit() or not (18 <= int(edad) <= 99):
        messagebox.showerror("Error", "Edad inv치lida. Debe ser 1899.")
        return False
    if not (celular.isdigit() and len(celular) == 10):
        messagebox.showerror("Error", "Tel칠fono inv치lido (10 d칤gitos).")
        return False
    if not (nss.isdigit() and len(nss) == 11):
        messagebox.showerror("Error", "NSS inv치lido (11 d칤gitos).")
        return False
    if not (len(curp) == 18 and curp.isalnum()):
        messagebox.showerror("Error", "CURP inv치lido (18 alfanum.).")
        return False
    return True

def limpiar_campos():
    for entry in [entry_nombre, entry_numero, entry_celular,
                  entry_domicilio, entry_edad, entry_nss, entry_curp]:
        entry.delete(0, tk.END)
    jornada_var.set("Matutina")
    genero_var.set("Femenino")
    area_var.set("General")
    dias_var.set("Lunes a Viernes")

def limpiar_campos_asistencia():
    entry_nombre_control.delete(0, tk.END)
    entry_numero_control.delete(0, tk.END)
    entry_hora_llegada.delete(0, tk.END)

def limpiar_campos_vacacion():
    entry_vac_nombre.delete(0, tk.END)
    entry_vac_numero.delete(0, tk.END)
    entry_vac_inicio.delete(0, tk.END)
    entry_vac_fin.delete(0, tk.END)

def registrar_entrada():
    nombre = entry_nombre.get()
    numero = entry_numero.get()

    if not validar_datos(nombre, numero,
                        entry_celular.get(), entry_domicilio.get(),
                        entry_edad.get(), genero_var.get(),
                        entry_nss.get(), entry_curp.get()):
        return

    jornada = jornada_var.get()
    ahora = datetime.now()
    clave = (nombre, numero)
    estado = obtener_estado(jornada, ahora, dias_var.get())

    if not listbox_puestos_global.curselection():
        messagebox.showerror("Error", "Selecciona un puesto")
        return
    puesto = listbox_puestos_global.get(listbox_puestos_global.curselection())

    if not listbox_contrato_global.curselection():
        messagebox.showerror("Error", "Selecciona un tipo de contrato")
        return
    tipo_contrato = listbox_contrato_global.get(listbox_contrato_global.curselection())

    if not tree_departamentos_global.selection():
        messagebox.showerror("Error", "Selecciona un departamento")
        return
    departamento = tree_departamentos_global.item(tree_departamentos_global.selection()[0])['text']

    if clave not in trabajadores:
        trabajadores[clave] = {
            "jornada": jornada, "retardos": 0, "faltas": 0,
            "celular": entry_celular.get(), "domicilio": entry_domicilio.get(),
            "edad": entry_edad.get(), "genero": genero_var.get(),
            "nss": entry_nss.get(), "curp": entry_curp.get(),
            "area": area_var.get(), "dias": dias_var.get(),
            "tipo_contrato": tipo_contrato, "puesto": puesto,
            "departamento": departamento
        }
    else:
        trabajadores[clave].update({
            "jornada": jornada, "celular": entry_celular.get(),
            "domicilio": entry_domicilio.get(), "edad": entry_edad.get(),
            "genero": genero_var.get(), "nss": entry_nss.get(),
            "curp": entry_curp.get(), "area": area_var.get(),
            "dias": dias_var.get(), "tipo_contrato": tipo_contrato,
            "puesto": puesto, "departamento": departamento
        })

    if estado == "Retardo":
        trabajadores[clave]["retardos"] += 1
        if trabajadores[clave]["retardos"] >= RETARDOS_PARA_FALTA:
            trabajadores[clave]["faltas"] += 1
            estado = "Falta"
            trabajadores[clave]["retardos"] = 0

    trabajadores[clave]["entrada"] = ahora.strftime("%I:%M %p")
    trabajadores[clave]["estado"] = estado

    resumen = (
        f"[ENTRADA] {nombre} ({numero}) - Jornada: {jornada}, "
        f"D칤as: {dias_var.get()}, Entrada: {trabajadores[clave]['entrada']}, "
        f"Estado: {estado}, CURP: {entry_curp.get()}, 츼rea: {area_var.get()}, "
        f"Departamento: {departamento}, Puesto: {puesto}, Tipo de contrato: {tipo_contrato}\n"
    )
    text_area.insert(tk.END, resumen)

    guardar_registro(nombre, numero)
    guardar_datos_json()
    limpiar_campos()


def registrar_salida():
    nombre = entry_nombre.get()
    numero = entry_numero.get()
    clave = (nombre, numero)
    if clave not in trabajadores:
        messagebox.showerror("Error", "No se encontr칩 registro de entrada.")
        return

    trabajadores[clave]["salida"] = datetime.now().strftime("%I:%M %p")

    departamento = trabajadores[clave].get("departamento", "No seleccionado")
    puesto = trabajadores[clave].get("puesto", "No seleccionado")
    tipo_contrato = trabajadores[clave].get("tipo_contrato", "No seleccionado")

    resumen = (f"[SALIDA] {nombre} ({numero}) - Salida: {trabajadores[clave]['salida']}, "
               f"Estado Final: {trabajadores[clave]['estado']}, "
               f"CURP: {trabajadores[clave].get('curp','N/A')}, "
               f"츼rea: {trabajadores[clave].get('area','N/A')}\n"
               f"Departamento: {departamento}, Puesto: {puesto}, Tipo de contrato: {tipo_contrato}\n\n")
    text_area.insert(tk.END, resumen)
    text_area.see(tk.END)

    guardar_registro(nombre, numero)
    guardar_datos_json()
    limpiar_campos()


def registrar_asistencia_ext():
    nombre = entry_nombre_control.get()
    numero = entry_numero_control.get()
    clave = (nombre, numero)
    if clave not in trabajadores:
        messagebox.showerror("Error", "Trabajador no encontrado.")
        return

    llegada_str = entry_hora_llegada.get().strip()
    llegada_str = llegada_str.upper()  

    formatos_validos = ["%I:%M %p", "%H:%M"]
    llegada = None

    for formato in formatos_validos:
        try:
            llegada = datetime.strptime(llegada_str, formato)
            break
        except ValueError:
            continue

    if llegada is None:
        messagebox.showerror("Formato inv치lido", "Formato aceptado: HH:MM AM/PM o 24h (ej. 07:00 AM, 13:30)")
        return

    hoy = datetime.now().strftime("%Y-%m-%d")
    t = trabajadores[clave]
    if hoy in t.get("vacaciones", []):
        messagebox.showinfo("Vacaciones", "Est치 de vacaciones hoy.")
        return

    estado = obtener_estado(t["jornada"], llegada, t["dias"])

    if estado == "Retardo":
        t["retardos"] = t.get("retardos", 0) + 1
        if t["retardos"] >= RETARDOS_PARA_FALTA:
            t["faltas"] = t.get("faltas", 0) + 1
            t["retardos"] = 0
            estado = "Falta"

    t.setdefault("asistencias_ext", []).append({"fecha": hoy, "tipo": estado})
    t["entrada"] = llegada.strftime("%I:%M %p")
    t["estado"] = estado

    text_area.insert(tk.END, f"[EXT-Asistencia] {nombre} ({numero})  {hoy} {t['entrada']} | {estado}\n")
    guardar_registro(nombre, numero)
    guardar_datos_json()
    limpiar_campos_asistencia()


def registrar_vacaciones_ext():
    nombre = entry_vac_nombre.get()
    numero = entry_vac_numero.get()
    clave = (nombre, numero)
    if clave not in trabajadores:
        messagebox.showerror("Error", "Trabajador no encontrado.")
        return
    try:
        fechas = rango_fechas(entry_vac_inicio.get(), entry_vac_fin.get())
    except:
        messagebox.showerror("Error", "Formato AAAA-MM-DD.")
        return
    t = trabajadores[clave]
    ok, conflicto = validar_vacaciones(t.get("turno"), fechas)
    if not ok:
        messagebox.showwarning("Conflicto", f"Turno saturado en {conflicto}")
        return
    t.setdefault("vacaciones", [])
    t["vacaciones"] = list(set(t["vacaciones"] + fechas))
    messagebox.showinfo("칄xito", "Vacaciones registradas.")
    guardar_registro(nombre, numero)
    guardar_datos_json()
    limpiar_campos_vacacion()


def crear_pesta침as_principales():
    global entry_nombre, entry_numero, entry_celular, entry_domicilio
    global entry_edad, entry_nss, entry_curp
    global jornada_var, genero_var, area_var, dias_var
    global listbox_puestos_global, listbox_contrato_global, tree_departamentos_global
    global entry_nombre_control, entry_numero_control, entry_hora_llegada
    global entry_vac_nombre, entry_vac_numero, entry_vac_inicio, entry_vac_fin
    global text_area

    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores Hospital Osamu")
    notebook = ttk.Notebook(ventana)
    notebook.pack(fill="both", expand=True)


    tab1 = ttk.Frame(notebook)
    notebook.add(tab1, text="Datos del Trabajador")
    labels = ["Nombre:", "N칰mero de Control:", "Celular:", "Domicilio:", "Edad:",
              "G칠nero:", "NSS:", "CURP:", "츼rea:", "Jornada:", "D칤as de trabajo:"]
    entries = {}
    for i, label in enumerate(labels):
        ttk.Label(tab1, text=label).grid(row=i, column=0, sticky="e", pady=2)
        if label in ["G칠nero:", "츼rea:", "Jornada:", "D칤as de trabajo:"]:
            var = tk.StringVar()
            if label == "G칠nero:": genero_var = var; var.set("Femenino"); opts = ["Femenino", "Masculino"]
            elif label == "츼rea:": area_var = var; var.set("General"); opts = [
                "Camillas","Consultorio","Cirujano","Doctor","Cardiolog칤a","Dermatolog칤a","Pediatr칤a",
                "Sala de Operaciones","Urgencias","General"]
            elif label == "Jornada:": jornada_var = var; var.set("Matutina"); opts = ["Matutina","Vespertina","Nocturna"]
            else: dias_var = var; var.set("Lunes a Viernes"); opts = ["Lunes a Viernes","S치bado y Domingo","Lun, Mar, Vie","Mi칠, Jue, S치b"]
            ttk.Combobox(tab1, textvariable=var, values=opts, state="readonly").grid(row=i, column=1)
        else:
            entry = ttk.Entry(tab1)
            entry.grid(row=i, column=1)
            entries[label] = entry

    entry_nombre = entries["Nombre:"]
    entry_numero = entries["N칰mero de Control:"]
    entry_celular = entries["Celular:"]
    entry_domicilio = entries["Domicilio:"]
    entry_edad = entries["Edad:"]
    entry_nss = entries["NSS:"]
    entry_curp = entries["CURP:"]

    ttk.Button(tab1, text="Registrar Entrada", command=registrar_entrada).grid(row=len(labels), column=0, pady=10)
    ttk.Button(tab1, text="Registrar Salida", command=registrar_salida).grid(row=len(labels), column=1, pady=10)

    tab4 = ttk.Frame(notebook)
    notebook.add(tab4, text="Puesto")
    frame_puesto = ttk.LabelFrame(tab4, text="Puesto")
    frame_puesto.pack(fill="both", expand=True, padx=10, pady=10)
    listbox_puestos_global = tk.Listbox(frame_puesto, height=5, exportselection=False)
    puestos = ["Gerente", "Analista", "Operativo", "Soporte"]
    for p in puestos:
        listbox_puestos_global.insert(tk.END, p)
    listbox_puestos_global.pack(fill="both", expand=True)

    tab5 = ttk.Frame(notebook)
    notebook.add(tab5, text="Tipo de contrato")
    frame_contrato = ttk.LabelFrame(tab5, text="Tipo de Contrato")
    frame_contrato.pack(fill="both", expand=True, padx=10, pady=10)
    listbox_contrato_global = tk.Listbox(frame_contrato, height=3, exportselection=False)
    contratos = ["Tiempo completo", "Medio tiempo", "Contrato temporal"]
    for c in contratos:
        listbox_contrato_global.insert(tk.END, c)
    listbox_contrato_global.pack(fill="both", expand=True)

    tab3 = ttk.Frame(notebook)
    notebook.add(tab3, text="Departamento")
    frame_departamento = ttk.LabelFrame(tab3, text="Departamento")
    frame_departamento.pack(fill="both", expand=True, padx=10, pady=10)
    tree_departamentos_global = ttk.Treeview(frame_departamento)
    departamentos = ["Ventas", "Compras", "Recursos Humanos", "TI"]
    for d in departamentos:
        tree_departamentos_global.insert("", "end", text=d)
    tree_departamentos_global.pack(fill="both", expand=True)


    tab6 = ttk.Frame(notebook)
    notebook.add(tab6, text="Asistencias Ext.")

    ttk.Label(tab6, text="Nombre:").grid(row=0, column=0)
    entry_nombre_control = ttk.Entry(tab6); entry_nombre_control.grid(row=0, column=1)
    ttk.Label(tab6, text="N칰mero control:").grid(row=1, column=0)
    entry_numero_control = ttk.Entry(tab6); entry_numero_control.grid(row=1, column=1)
    ttk.Label(tab6, text="Hora llegada (HH:MM):").grid(row=2, column=0)
    entry_hora_llegada = ttk.Entry(tab6); entry_hora_llegada.grid(row=2, column=1)
    ttk.Button(tab6, text="Registrar asistencia", command=registrar_asistencia_ext).grid(row=3, column=0, columnspan=2, pady=10)

    tab7 = ttk.Frame(notebook)
    notebook.add(tab7, text="Vacaciones")

    ttk.Label(tab7, text="Nombre:").grid(row=0, column=0)
    entry_vac_nombre = ttk.Entry(tab7); entry_vac_nombre.grid(row=0, column=1)
    ttk.Label(tab7, text="N칰mero control:").grid(row=1, column=0)
    entry_vac_numero = ttk.Entry(tab7); entry_vac_numero.grid(row=1, column=1)
    ttk.Label(tab7, text="Inicio AAAA-MM-DD:").grid(row=2, column=0)
    entry_vac_inicio = ttk.Entry(tab7); entry_vac_inicio.grid(row=2, column=1)
    ttk.Label(tab7, text="Fin AAAA-MM-DD:").grid(row=3, column=0)
    entry_vac_fin = ttk.Entry(tab7); entry_vac_fin.grid(row=3, column=1)
    ttk.Button(tab7, text="Registrar vacaciones", command=registrar_vacaciones_ext).grid(row=4, column=0, columnspan=2, pady=10)


    def actualizar_nombre_vac(*args):
        num = entry_vac_numero.get().strip()
        nombre = ""
        for (n, numk), v in trabajadores.items():
            if numk == num:
                nombre = n; break
        entry_vac_nombre.delete(0, tk.END)
        entry_vac_nombre.insert(0, nombre)
    entry_vac_numero.bind("<KeyRelease>", actualizar_nombre_vac)
    entry_vac_numero.bind("<FocusOut>", actualizar_nombre_vac)

    tab2 = ttk.Frame(notebook)
    notebook.add(tab2, text="Historial")
    text_area = tk.Text(tab2, height=20, width=100)
    text_area.pack(padx=10, pady=10)

    # === PESTA칌A LISTADO ===
    tab_listado = ttk.Frame(notebook)
    notebook.add(tab_listado, text="Listado")

    columnas = ("Nombre", "N칰mero", "G칠nero", "Edad", "츼rea", "Puesto", "Turno", "Jornada", "D칤as", "Asistencias", "Retardos", "Faltas", "Vacaciones")
    tree_listado = ttk.Treeview(tab_listado, columns=columnas, show="headings")

    for col in columnas:
        tree_listado.heading(col, text=col)
        tree_listado.column(col, width=120)

    tree_listado.pack(fill="both", expand=True)

    def actualizar_listado():
        tree_listado.delete(*tree_listado.get_children())
        for (nombre, numero), t in trabajadores.items():
            tree_listado.insert("", "end", values=(
                nombre,
                numero,
                t.get("genero", ""),
                t.get("edad", ""),
                t.get("area", ""),
                t.get("puesto", ""),
                t.get("turno", ""),
                t.get("jornada", ""),
                t.get("dias", ""),
                1 if "entrada" in t else 0,
                t.get("retardos", 0),
                t.get("faltas", 0),
                len(t.get("vacaciones", []))
            ))

    def al_cambiar_pestana(event):
        if notebook.index(notebook.select()) == notebook.tabs().index(str(tab_listado)):
            actualizar_listado()

    notebook.bind("<<NotebookTabChanged>>", al_cambiar_pestana)


    ventana.mainloop()


def verificar_contrasena():
    global intentos
    if entry_contrasena.get() == "hospital":
        login.destroy()
        crear_pesta침as_principales()
    else:
        intentos += 1
        if intentos >= 3:
            messagebox.showerror("Acceso denegado", "Demasiados intentos")
            login.destroy()
        else:
            messagebox.showerror("Error", "Contrase침a incorrecta")

def abrir_login():
    global login, entry_contrasena
    bienvenida.destroy()
    login = tk.Tk()
    login.title("Verificaci칩n de contrase침a")
    login.geometry("400x250")
    login.config(bg="lightpink")
    ttk.Label(login, text="Ingresa la contrase침a:").pack(pady=10)
    entry_contrasena = ttk.Entry(login, show="*"); entry_contrasena.pack()
    ttk.Label(login, text='(la contrase침a es "hospital")', foreground="blue").pack(pady=5)
    ttk.Button(login, text="Entrar", command=verificar_contrasena).pack(pady=10)
    login.mainloop()

bienvenida = tk.Tk()
bienvenida.title("Bienvenido al hospital Osamu 游눘")
bienvenida.geometry("600x300")
bienvenida.config(bg="lightblue")
ttk.Label(bienvenida, text="Bienvenido al sistema de registro del hospital Osamu", font=("Times New Roman", 16)).pack(pady=20)
ttk.Button(bienvenida, text="Iniciar sesi칩n", command=abrir_login).pack(pady=30)

bienvenida.mainloop()

# INTENTO 13:
(FINAL)


