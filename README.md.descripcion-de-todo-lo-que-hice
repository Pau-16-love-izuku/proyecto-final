##------- EN ESTE README VOY A AGREGAR TODAS LAS DESCRIPCIONES Y ALGUNOS CAMBIOS PRINCIPALES DE TODOS MIS ARCHIVOS DE INTENTO-------

# INTENTO 1: (descrpcion y explicacion)
#Proyecto final segundo parcial:
#planeacion:
#Voy a generar un programa en python usando tkinter para la administracion de permisos, vacaciones, o dias economicos que los trabajadores solicitan en un hospital, sin que sean descontados de su salario, utilizando una interfaz
#El programa va a consistir en el control de las asistencias totales 
#Pienso comenzar investigando como hacer la interfaz
#Luego, voy a determinar un cierto numero de trabajadores y voy a hacer el codigo en base a ese numero para darle un alto o que marque error si se ingresa un numero que no esta incluido en el sistema
#Voy a poner letreros que digan cosas como 'por favor ingresa tu numero de control' o 'porfavor ingresa tu puesto ' para tener los datos de entrada
#Voy a usar funciones como el if o for para determinar los dias de vacaiones y saber cuando un empledado respeta o no los periodos 
#voy a poner clases y un messagebox
#para que funcione voy a agregar una base con los datos, porque ya vi que para que los ingresen manual no funciona
#codigo
#para la base de datos voy a definir un taple si no existe asistencia de algun trabajador para que si este 
#sin persistencia de datos json, porque no esta hecho para guardar datos 
#agregare la funcion datetime para el codigo final porque si sirvio


# INTENTO 2
#codigo de prueba 2: (descripcion e intento)
#ya funciono pero le falta la entrada para agregar mas datos, y la parte que registra al trabajador aun no funciona bien :(

import tkinter as tk
from tkinter import messagebox, simpledialog
import sqlite3
from datetime import datetime
class Hospitalcontrol:
    def __init__(self, root):  
        self.root = root
        self.root.title("Control de Asistencia - Hospital")
        self.create_widgets()
        self.create_db()

    def create_widgets(self):
        self.entrada_button = tk.Button(self.root, text="Registrar Entrada", command=self.registrar_entrada)
        self.entrada_button.pack(pady=5)

        self.salida_button = tk.Button(self.root, text="Registrar Salida", command=self.registrar_salida)
        self.salida_button.pack(pady=5)

        self.reporte_button = tk.Button(self.root, text="Generar Reporte", command=self.generar_reporte)
        self.reporte_button.pack(pady=5)

    def create_db(self):
        self.conn = sqlite3.connect('database.db')
        self.cursor = self.conn.cursor()
        self.cursor.execute('''CREATE TABLE IF NOT EXISTS asistencia (
                                id INTEGER PRIMARY KEY,
                                nombre TEXT,
                                turno TEXT,
                                entrada DATETIME,
                                salida DATETIME)''')
        self.conn.commit()

    def registrar_entrada(self):
        nombre = simpledialog.askstring("Entrada", "Nombre del trabajador:")
        turno = simpledialog.askstring("Entrada", "Turno (M/V/N):").upper() if nombre else None
        if nombre and turno in ['M', 'V', 'N']:
            entrada = datetime.now()
            self.cursor.execute("INSERT INTO asistencia (nombre, turno, entrada) VALUES (?, ?, ?)",
                                (nombre, turno, entrada))
            self.conn.commit()
            messagebox.showinfo("Éxito", f"Entrada registrada para {nombre} en turno {turno}.")
        else:
            messagebox.showerror("Error", "Debe ingresar un nombre y un turno válido (M, V, N).")

    def registrar_salida(self):
        nombre = simpledialog.askstring("Salida", "Nombre del trabajador:")
        if nombre:
            salida = datetime.now()
            self.cursor.execute("UPDATE asistencia SET salida = ? WHERE nombre = ? AND salida IS NULL",
                                (salida, nombre))
            self.conn.commit()
            messagebox.showinfo("Éxito", f"Salida registrada para {nombre}.")
        else:
            messagebox.showerror("Error", "Debe ingresar un nombre.")

    def generar_reporte_trabajador(self):
        self.cursor.execute("SELECT nombre, turno, entrada, salida FROM asistencia")
        registros = self.cursor.fetchall()
        reporte = "Reporte de Asistencia:\n\n"
        for nombre, turno, entrada, salida in registros:
            entrada = datetime.strptime(entrada, '%Y-%m-%d %H:%M:%S')
            salida_dt = datetime.strptime(salida, '%Y-%m-%d %H:%M:%S') if salida else None
            horas_trabajadas = (salida_dt - entrada).total_seconds() / 3600 if salida_dt else 0
            reporte += f"{nombre} - Turno {turno} - Entrada: {entrada.strftime('%H:%M:%S')} - "
            reporte += f"Salida: {salida_dt.strftime('%H:%M:%S') if salida_dt else 'Pendiente'} - "
            reporte += f"Horas: {horas_trabajadas:.2f}\n"

        messagebox.showinfo("Reporte de Asistencia", reporte)

if __name__ == "__main__":  
    root = tk.Tk()
    app = HospitalApp(root)
    root.mainloop()


# INTENTO 3:

#este es mi tercer intento, porque ya le agregue botones para que si se puedan ingresar los datos por el trabajador, porque en el otro le faltaba entrada para datos
#aun conservo el datetime, aunque aun no lo uso bien
#utilize una lista para poder agregar los trabajadores y ya funciona el registro
#intento de codigo numero 3:
#la mayoria de los codigos los hago en code visual studio y ya los pongo aqui

import tkinter as tk
from tkinter import messagebox
from datetime import datetime
trabajadores = []
def registrar_horario():
    nombre = entry_nombre.get()
    entrada_str = entry_entrada.get()
    salida_str = entry_salida.get()
    try:
        entrada = datetime.strptime(entrada_str, "%H:%M")
        salida = datetime.strptime(salida_str, "%H:%M")
        hora_limite = datetime.strptime("07:20", "%H:%M")
        if entrada > hora_limite:
            estado = "Retardo"
        else:
            estado = "Puntual"
        if entrada > datetime.strptime("08:00", "%H:%M"):
            estado = "Falta"
        trabajador = {
            "Nombre": nombre,
            "Turno": turno_var.get(),
            "Domicilio": entry_domicilio.get(),
            "Puesto": puesto_var.get(),
            "Entrada": entrada_str,
            "Salida": salida_str,
            "Estado": estado
        }
        
        trabajadores.append(trabajador)
        messagebox.showinfo("Registrado", f"Horario registrado: {estado}")
    except ValueError:
        messagebox.showerror("Error", "Formato de hora inválido. Usa HH:MM")

ventana = tk.Tk()
ventana.title("Registro de Trabajadores")

tk.Label(ventana, text="Nombre:").grid(row=0, column=0)
entry_nombre = tk.Entry(ventana)
entry_nombre.grid(row=0, column=1)

tk.Label(ventana, text="Turno:").grid(row=1, column=0)
turno_var = tk.StringVar()
turno_var.set("Matutino")
tk.OptionMenu(ventana, turno_var, "Matutino", "Vespertino", "Nocturno").grid(row=1, column=1)

tk.Label(ventana, text="Domicilio:").grid(row=2, column=0)
entry_domicilio = tk.Entry(ventana)
entry_domicilio.grid(row=2, column=1)

tk.Label(ventana, text="Puesto:").grid(row=3, column=0)
puesto_var = tk.StringVar()
puesto_var.set("Doctor")
tk.OptionMenu(ventana, puesto_var, "Doctor", "Enfermero", "Cirujano").grid(row=3, column=1)

tk.Label(ventana, text="Hora Entrada (HH:MM):").grid(row=4, column=0)
entry_entrada = tk.Entry(ventana)
entry_entrada.grid(row=4, column=1)

tk.Label(ventana, text="Hora Salida (HH:MM):").grid(row=5, column=0)
entry_salida = tk.Entry(ventana)
entry_salida.grid(row=5, column=1)
tk.Button(ventana, text="Registrar Horario", command=registrar_horario).grid(row=6, column=0, columnspan=2, pady=10)
ventana.mainloop()

#INTENTO 4: 

#intento de codigo para el proyecto: 4
# en este ya le agregue el dato de la curp 
#agregue un boton que pide una contraseña para que el trabajador pueda registrarse, porque se me ocurrio
#aun conservo las funciones como try e if


import tkinter as tk
from tkinter import messagebox
from datetime import datetime
trabajadores = []
intentos = 0
def registrar_horario():
    nombre = entry_nombre.get()
    entrada_str = entry_entrada.get()
    salida_str = entry_salida.get()

    try:
        entrada = datetime.strptime(entrada_str, "%I:%M %p")
        salida = datetime.strptime(salida_str, "%I:%M %p")
        hora_limite = datetime.strptime("7:20 AM", "%I:%M %p")

        if entrada > datetime.strptime("8:00 AM", "%I:%M %p"):
            estado = "Falta"
        elif entrada > hora_limite:
            estado = "Retardo"
        else:
            estado = "Puntual"

        trabajador = {
            "Nombre": nombre,
            "Turno": turno_var.get(),
            "Domicilio": entry_domicilio.get(),
            "Puesto": puesto_var.get(),
            "Entrada": entrada_str,
            "Salida": salida_str,
            "Estado": estado, 
            "CURP": entry_curp.get()
        }

        trabajadores.append(trabajador)
        messagebox.showinfo("Registrado", f"Horario registrado: {estado}")

    except ValueError:
        messagebox.showerror("Error", "Formato de hora inválido. Usa HH:MM AM/PM")


def mostrar_menu():
    login.destroy()  

    global ventana
    ventana = tk.Tk()
    ventana.title("Registro de Trabajadores")

    tk.Label(ventana, text="Nombre:").grid(row=0, column=0)
    global entry_nombre
    entry_nombre = tk.Entry(ventana)
    entry_nombre.grid(row=0, column=1)

    tk.Label(ventana, text="Turno:").grid(row=1, column=0)
    global turno_var
    turno_var = tk.StringVar()
    turno_var.set("Matutino")
    tk.OptionMenu(ventana, turno_var, "Matutino", "Vespertino", "Nocturno").grid(row=1, column=1)

    tk.Label(ventana, text="Domicilio:").grid(row=2, column=0)
    global entry_domicilio
    entry_domicilio = tk.Entry(ventana)
    entry_domicilio.grid(row=2, column=1)

    tk.Label(ventana, text="Puesto:").grid(row=3, column=0)
    global puesto_var
    puesto_var = tk.StringVar()
    puesto_var.set("Doctor")
    tk.OptionMenu(ventana, puesto_var, "Doctor", "Enfermero", "Cirujano").grid(row=3, column=1)

    tk.Label(ventana, text="Hora Entrada (ej. 7:10 AM):").grid(row=4, column=0)
    global entry_entrada
    entry_entrada = tk.Entry(ventana)
    entry_entrada.grid(row=4, column=1)

    tk.Label(ventana, text="Hora Salida (ej. 3:00 PM):").grid(row=5, column=0)
    global entry_salida
    entry_salida = tk.Entry(ventana)
    entry_salida.grid(row=5, column=1)
    
    tk.Label(ventana, text=" CURP:").grid(row=6, column=0)
    global entry_curp
    entry_curp = tk.Entry(ventana)
    entry_curp.grid(row=6, column=1)

    tk.Button(ventana, text="Registrar Horario", command=registrar_horario).grid(row=7, column=1, columnspan=2, pady=10)

def verificar_contraseña():
    global intentos
    contraseña = entry_contraseña.get()

    if contraseña == "hospital":
        mostrar_menu()
    else:
        intentos += 1
        if intentos < 3:
            messagebox.showerror("Error", "Contraseña incorrecta, inténtalo de nuevo")
        else:
            messagebox.showerror("Acceso denegado", "Vuelve a intentarlo más tarde")
            login.destroy()

login = tk.Tk()
login.title("Login")
tk.Label(login, text="Ingresa la contraseña:").pack(pady=10)
entry_contraseña = tk.Entry(login, show="*")
entry_contraseña.pack()
tk.Button(login, text="Entrar", command=verificar_contraseña).pack(pady=5)

login.mainloop()


# INTENTO 5: 




